const $=e=>document.querySelector(e),rnd=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,tabs=document.querySelectorAll('[role="tab"]'),panels=document.querySelectorAll('[role="tabpanel"]');function autoRenderCursos(){const e=document.getElementById("cursoGrid");e&&["Aritmética","Álgebra","Geometría","Trigonometría","Cálculo diferencial","Cálculo integral","Probabilidad","Estadística"].forEach(t=>{const n=document.createElement("article");n.className="curso-card",n.innerHTML=`<h3>${t}</h3><p>Clases personalizadas</p>`,e.appendChild(n)})}tabs.forEach(e=>{e.addEventListener("click",()=>{tabs.forEach(e=>e.setAttribute("aria-selected","false")),panels.forEach(e=>e.hidden=!0),e.setAttribute("aria-selected","true"),document.getElementById(e.getAttribute("aria-controls")).hidden=!1})}),autoRenderCursos();const form=document.getElementById("contactForm"),drop=document.getElementById("dropZone"),fileBtn=document.getElementById("fileBtn"),fileInput=document.createElement("input");fileInput.type="file",fileInput.multiple=!0;const fileList=document.getElementById("fileList");let files=[];function updateFileList(){fileList.innerHTML="",files.forEach(e=>{const t=document.createElement("li");t.textContent=e.name,fileList.appendChild(t)})}fileBtn?.addEventListener("click",()=>fileInput.click()),fileInput.addEventListener("change",()=>{files=[...fileInput.files],updateFileList()}),["dragenter","dragover"].forEach(e=>drop?.addEventListener(e,e=>{e.preventDefault(),drop.classList.add("drag")})),["dragleave","drop"].forEach(e=>drop?.addEventListener(e,e=>{e.preventDefault(),drop.classList.remove("drag")})),drop?.addEventListener("drop",e=>{files=[...e.dataTransfer.files],updateFileList()}),form?.addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("formStatus"),n=new FormData(form);files.length&&files.forEach(e=>n.append("archivos[]",e)),t.textContent="enviando…",fetch("save.php",{method:"POST",body:n}).then(e=>e.json()).then(e=>{t.textContent=e.ok?"recibido":e.error||"error al enviar",e.ok&&(form.reset(),files=[],updateFileList())}).catch(()=>t.textContent="error al enviar")});const canvas=document.getElementById("game");if(canvas){const e=canvas.getContext("2d"),t=canvas.width,n=canvas.height;let o=[],a=0,r=5,l=performance.now(),i=0,c=!1,d=1,s=3;$("#difficulty").oninput=e=>d=+e.target.value,$("#speed").oninput=e=>s=+e.target.value;const p=$("#typedDisplay"),u=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg"),f=new Audio("https://actions.google.com/sounds/v1/explosions/explosion.ogg"),m=new Set(["+","-","×","÷","√","^"]);function randomProblem(){const e=[...m][rnd(0,m.size-1)];let t,n,o,a,r=20*d;switch(e){case"+":t=rnd(1,r),n=rnd(1,r),a=t+n,o=`${t}+${n}`;break;case"-":t=rnd(1,r),n=rnd(1,t),a=t-n,o=`${t}-${n}`;break;case"×":t=rnd(2,10*d),n=rnd(2,10*d),a=t*n,o=`${t}×${n}`;break;case"÷":n=rnd(2,10*d),a=rnd(2,10*d),t=n*a,o=`${t}÷${n}`;break;case"√":a=rnd(2,12*d),t=a*a,o=`√${t}`;break;case"^":t=rnd(2,9),n=rnd(2,Math.min(4,d+1)),a=t**n,o=`${t}^${n}`}return{q:o,ans:a}}function spawnBomb(){if(c||o.length>=3)return;const e=randomProblem(),a=(n-25)/2e4*s,r=["circle","missile","diamond"];o.push({x:rnd(60,t-60),y:-25,vy:a,r:18,shape:r[rnd(0,r.length-1)],...e})}document.querySelectorAll("#opMenu input[type=checkbox]").forEach(e=>{e.onchange=t=>e.checked?m.add(e.dataset.op):m.delete(e.dataset.op)});const h=document.getElementById("keypad");["1","2","3","4","5","6","7","8","9","0","⌫","⏎"].forEach(e=>{const t=document.createElement("button");t.textContent=e,h.appendChild(t)});let y="";function commit(){const e=o.findIndex(e=>e.ans===+y);-1!==e&&(o.splice(e,1),a++,u.cloneNode().play()),y="",updateHUD()}function updateHUD(){$("#hud").textContent=`Aciertos ${a}  Errores ${r}/5`,p.textContent=y}function update(e){o.forEach(t=>t.y+=t.vy*e),o=o.filter(e=>!(e.y-e.r>n)||(r--,f.cloneNode().play(),!1)),r<=0&&(c=!0,o=[]),!c&&performance.now()>i&&(spawnBomb(),i=performance.now()+3500/d)}function draw(){e.clearRect(0,0,t,n),e.fillStyle="#0a0a2a",e.fillRect(0,0,t,n),e.fillStyle="#333";for(let o=0;o<t;o+=50){const t=rnd(20,80);e.fillRect(o,n-t,40,t)}e.strokeStyle=e.fillStyle="white",e.lineWidth=2,o.forEach(t=>{switch(t.shape){case"circle":e.beginPath(),e.arc(t.x,t.y,t.r,0,2*Math.PI),e.stroke(),e.beginPath(),e.moveTo(t.x,t.y-t.r),e.lineTo(t.x,t.y-t.r-8),e.stroke();break;case"missile":e.beginPath(),e.rect(t.x-10,t.y-20,20,40),e.stroke(),e.beginPath(),e.moveTo(t.x,t.y-30),e.lineTo(t.x-10,t.y-20),e.lineTo(t.x+10,t.y-20),e.closePath(),e.stroke();break;case"diamond":e.beginPath(),e.moveTo(t.x,t.y-t.r),e.lineTo(t.x+t.r,t.y),e.lineTo(t.x,t.y+t.r),e.lineTo(t.x-t.r,t.y),e.closePath(),e.stroke()}e.font='16px "Share Tech Mono", monospace',e.textAlign="center",e.fillText(t.q,t.x,t.y+5)})}function loop(o){const a=o-l;l=o,c?(e.fillStyle="rgba(0,0,0,.8)",e.fillRect(0,0,t,n),e.fillStyle="#fff",e.font='48px "Share Tech Mono", monospace',e.textAlign="center",e.fillText("GAME OVER",t/2,n/2)):(update(a),draw(),requestAnimationFrame(loop)),updateHUD()}h.addEventListener("click",e=>{const t=e.target.textContent;"⌫"===t?y=y.slice(0,-1):"⏎"===t?commit():y+=t,updateHUD()}),document.addEventListener("keydown",e=>{/[0-9]/.test(e.key)?(y+=e.key,updateHUD()):"Backspace"===e.key?(y=y.slice(0,-1),updateHUD()):"Enter"===e.key&&commit()}),$("#restartBtn").addEventListener("click",()=>{o=[],a=0,r=5,y="",c=!1,$("#restartBtn").classList.add("hidden"),spawnBomb(),l=performance.now(),loop(l)}),spawnBomb(),loop(performance.now())}