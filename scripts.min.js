const $=e=>document.querySelector(e),rnd=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;function loadRegs(){let e=JSON.parse(localStorage.getItem("registros"));return e||(e=[{nombre:"Ana Torres",telefono:"5512345678",correo:"ana@example.com"},{nombre:"Luis P√©rez",telefono:"5598765432",correo:"luis@example.com"}],localStorage.setItem("registros",JSON.stringify(e))),e}const music=document.getElementById("bgMusic");function startMusic(){music&&music.play().catch(()=>{})}function showCountdownBubble(){const e=document.getElementById("notify");if(!e)return;const t=JSON.parse(localStorage.getItem("messages")||"[]");if(0===t.length)return void(e.innerHTML="");e.innerHTML="";const n=document.createElement("div");n.className="bubble";let a=20;n.innerHTML=`<strong>Tienes ${t.length} mensaje(s) pendientes.</strong><span class="timer">${a}s</span>`,e.appendChild(n);const o=setInterval(()=>{a--,n.querySelector(".timer").textContent=a+"s",a<=0&&(clearInterval(o),n.remove())},1e3)}document.addEventListener("click",startMusic,{once:!0}),window.addEventListener("load",showCountdownBubble);const regForm=$("#registroForm"),dataTable=$("#dataTable");if(regForm&&dataTable){function renderRegs(){const e=loadRegs();dataTable.innerHTML="<tr><th>Nombre</th><th>Tel√©fono</th><th>Correo</th></tr>",e.forEach(e=>dataTable.insertAdjacentHTML("beforeend",`<tr><td>${e.nombre}</td><td>${e.telefono}</td><td>${e.correo}</td></tr>`))}function exportRegs(){const e=XLSX.utils.book_new(),t=XLSX.utils.json_to_sheet(loadRegs());XLSX.utils.book_append_sheet(e,t,"Registros"),XLSX.writeFile(e,"registros.xlsx")}renderRegs(),exportRegs(),regForm.addEventListener("submit",e=>{e.preventDefault();const t=new FormData(regForm),n=t.get("nombre").trim(),a=t.get("telefono").trim(),o=t.get("correo").trim();if(!/^\d{10}$/.test(a))return void alert("El tel√©fono debe tener 10 d√≠gitos");const r=loadRegs();r.push({nombre:n,telefono:a,correo:o}),localStorage.setItem("registros",JSON.stringify(r)),regForm.reset(),renderRegs(),exportRegs()})}document.querySelectorAll(".ledPhone").forEach(e=>{const t=["#00eaff","#ff4dff","#ffca28","#4dabf5","#81c784"],n="(+52) 56 1088 5357".split("");e.innerHTML=n.map(e=>" "===e?e:`<span style="color:${t[rnd(0,t.length-1)]}">${e}</span>`).join("")});const baseTopics=e=>Array.from({length:e},(e,t)=>`Tema ${t+1}`),cursosData=[["ARITM√âTICA",baseTopics(20),"LMV","üßÆ"],["√ÅLGEBRA",baseTopics(20),"MJ","‚àë"],["GEOMETR√çA",baseTopics(20),"LMV","üìê"],["TRIGONOMETR√çA",baseTopics(20),"MJ","üìà"]],scheduleDays={LMV:[1,3,5],MJ:[2,4]},grid=document.getElementById("cursoGrid"),today=new Date;function countSessions(e,t,n){let a=0,o=new Date(e);for(;o<=t;)n.includes(o.getDay())&&a++,o.setDate(o.getDate()+1);return a}if(grid&&(cursosData.forEach((e,t)=>{const n=new Date;n.setDate(n.getDate()+14+7*t);const a=new Date(n);a.setDate(a.getDate()+14);const o=2*countSessions(n,a,scheduleDays[e[2]])*300,r=Math.ceil((n-today)/864e5);let s=1.2,i="#81c784";r<=2?(s=.2,i="#ff5555"):r<=7?(s=.5,i="#ffca28"):r<=14&&(s=.8,i="#ffca28"),grid.insertAdjacentHTML("beforeend",`\n      <article class="card" style="--freq:${s}s;--tone:${i}">\n        <h3><span class="gold">${e[3]}</span>${e[0]}</h3>\n        <p><strong>Inicio:</strong> ${n.getDate()}/${n.getMonth()+1}</p>\n        <p><strong>Fin:</strong> ${a.getDate()}/${a.getMonth()+1}</p>\n        <p><strong>Costo:</strong> $${o} MXN</p>\n        <button class="temarioBtn">Temario</button>\n        <ul class="temario" hidden>${e[1].map(e=>`<li>${e}</li>`).join("")}</ul>\n        <button class="agendarBtn">Agendar llamada</button>\n        <form class="agendaForm" hidden>\n          <input type="date" name="fecha" required />\n          <input type="text" name="nombre" placeholder="Nombre" required />\n          <input type="tel" name="whatsapp" placeholder="WhatsApp" required />\n          <input type="email" name="correo" placeholder="Correo" required />\n          <button type="submit">Guardar</button>\n        </form>\n      </article>`)}),grid.addEventListener("click",e=>{if(e.target.closest("article.card")&&!e.target.closest("button")&&!e.target.closest("form")&&!e.target.closest(".temario")){const e=document.getElementById("contactForm");e&&(e.classList.add("highlight"),location.hash="#contacto")}e.target.classList.contains("agendarBtn")&&(e.target.nextElementSibling.hidden=!e.target.nextElementSibling.hidden)}),grid.addEventListener("dblclick",e=>{e.target.classList.contains("temarioBtn")&&(e.target.nextElementSibling.hidden=!e.target.nextElementSibling.hidden)}),grid.addEventListener("submit",e=>{if(e.target.classList.contains("agendaForm")){e.preventDefault();const t=e.target.closest("article.card"),n=Object.fromEntries(new FormData(e.target).entries()),a=t.querySelector("h3").textContent.trim();n.curso=a.replace(/^[^A-Za-z√Å√â√ç√ì√ö√ë]+/,"");const o=JSON.parse(localStorage.getItem("messages")||"[]");o.push(n),localStorage.setItem("messages",JSON.stringify(o)),alert("¬°Sesi√≥n apartada!"),e.target.hidden=!0,showCountdownBubble()}})),$("#contactForm")){const e=$("#contactForm select[name=curso]");cursosData.forEach(t=>{const n=document.createElement("option");n.value=n.textContent=t[0],e.appendChild(n)})}const contactForm=$("#contactForm");contactForm&&contactForm.addEventListener("submit",e=>{e.preventDefault();const t=Object.fromEntries(new FormData(contactForm).entries());t.fecha=(new Date).toISOString(),t.contactado=!1,t.notas="";const n=JSON.parse(localStorage.getItem("messages")||"[]");n.push(t),localStorage.setItem("messages",JSON.stringify(n)),alert("Mensaje enviado"),contactForm.reset(),showCountdownBubble()});const loginForm=$("#loginForm"),adminPanel=$("#adminPanel");function renderAdminTable(){const e=$("#msgTable");if(!e)return;const t=JSON.parse(localStorage.getItem("messages")||"[]");e.innerHTML="<tr><th>Nombre</th><th>WhatsApp</th><th>Correo</th><th>Curso</th><th>Mensaje</th></tr>",t.forEach(t=>{e.insertAdjacentHTML("beforeend",`<tr><td>${t.nombre}</td><td>${t.whatsapp}</td><td>${t.email}</td><td>${t.curso}</td><td>${t.mensaje}</td></tr>`)})}loginForm&&adminPanel&&(loginForm.addEventListener("submit",e=>{e.preventDefault();const t=$("#pwd").value.trim();"2025"===t||"1991"===t?(loginForm.hidden=!0,adminPanel.hidden=!1,renderAdminTable(),renderFiles()):alert("Contrase√±a incorrecta")}),$("#saveCourse").addEventListener("click",()=>alert("Datos guardados (simulado)")));const adminDrop=$("#adminFiles"),adminList=$("#adminFileList");function renderFiles(){if(!adminList)return;const e=JSON.parse(localStorage.getItem("files")||"[]");adminList.innerHTML="",e.forEach(e=>{"application/pdf"===e.type?adminList.insertAdjacentHTML("beforeend",`<p><a href="${e.data}" target="_blank">${e.name}</a></p>`):e.type.startsWith("image/")&&adminList.insertAdjacentHTML("beforeend",`<img src="${e.data}" alt="${e.name}" style="max-width:100px;margin:5px;">`)})}function storeFile(e){const t=new FileReader;t.onload=()=>{const n=JSON.parse(localStorage.getItem("files")||"[]");n.push({name:e.name,type:e.type,data:t.result}),localStorage.setItem("files",JSON.stringify(n)),renderFiles()},t.readAsDataURL(e)}adminDrop&&(["dragenter","dragover"].forEach(e=>adminDrop.addEventListener(e,e=>{e.preventDefault(),adminDrop.classList.add("dragover")})),["dragleave","drop"].forEach(e=>adminDrop.addEventListener(e,e=>{e.preventDefault(),adminDrop.classList.remove("dragover")})),adminDrop.addEventListener("drop",e=>{[...e.dataTransfer.files].forEach(storeFile)}),adminDrop.addEventListener("click",()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=()=>{[...e.files].forEach(storeFile)},e.click()}));const mailLogin=$("#mailLogin"),mailSection=$("#mailSection");function renderMessages(){const e=$("#msgList"),t=JSON.parse(localStorage.getItem("messages")||"[]");e.innerHTML="",t.forEach((t,n)=>{e.insertAdjacentHTML("beforeend",`\n      <div class="msg">\n        <p><strong>${t.nombre}</strong> (${t.email}) - ${t.curso}</p>\n        <p>${t.mensaje}</p>\n        <label><input type="checkbox" data-idx="${n}" class="chkContact" ${t.contactado?"checked":""}/> Contactado</label>\n        <textarea data-idx="${n}" class="note">${t.notas||""}</textarea>\n      </div>`)})}mailLogin&&(mailLogin.addEventListener("submit",e=>{e.preventDefault();const t=$("#mailPwd").value.trim();"2025"===t||"1991"===t?(mailLogin.hidden=!0,mailSection.hidden=!1,renderMessages()):alert("Contrase√±a incorrecta")}),document.addEventListener("change",e=>{if(e.target.classList.contains("chkContact")||e.target.classList.contains("note")){const t=JSON.parse(localStorage.getItem("messages")||"[]"),n=e.target.dataset.idx;e.target.classList.contains("chkContact")?t[n].contactado=e.target.checked:t[n].notas=e.target.value,localStorage.setItem("messages",JSON.stringify(t))}}));const drop=$("#dropZone"),preview=$("#preview");drop&&preview&&(["dragenter","dragover"].forEach(e=>drop.addEventListener(e,e=>{e.preventDefault(),drop.classList.add("dragover")})),["dragleave","drop"].forEach(e=>drop.addEventListener(e,e=>{e.preventDefault(),drop.classList.remove("dragover")})),drop.addEventListener("drop",e=>{const t=e.dataTransfer.files[0];if(!t)return;const n=new FileReader;n.onload=()=>{preview.innerHTML=t.type.startsWith("image")?`<img src="${n.result}" style="max-width:100%">`:`<pre>${n.result.slice(0,1200)}‚Ä¶</pre>`},t.type.startsWith("image")?n.readAsDataURL(t):n.readAsText(t)}),drop.addEventListener("click",()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=()=>preview.textContent=`Archivo cargado: ${e.files[0].name}`,e.click()}));const canvas=document.getElementById("game");if(canvas){const t=canvas.getContext("2d"),n=canvas.width,a=canvas.height;let o=[],r=0,s=5,i=performance.now(),c=0,d=!1,l=1,m=3;$("#difficulty").oninput=e=>l=+e.target.value,$("#speed").oninput=e=>m=+e.target.value;const g=$("#typedDisplay"),p=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg"),u=new Audio("https://actions.google.com/sounds/v1/explosions/explosion.ogg"),f=new Set(["+","-","√ó","√∑","‚àö","^"]);function randomProblem(){const e=[...f][rnd(0,f.size-1)];let t,n,a,o,r=20*l;switch(e){case"+":t=rnd(1,r),n=rnd(1,r),o=t+n,a=`${t}+${n}`;break;case"-":t=rnd(1,r),n=rnd(1,t),o=t-n,a=`${t}-${n}`;break;case"√ó":t=rnd(2,10*l),n=rnd(2,10*l),o=t*n,a=`${t}√ó${n}`;break;case"√∑":n=rnd(2,10*l),o=rnd(2,10*l),t=n*o,a=`${t}√∑${n}`;break;case"‚àö":o=rnd(2,12*l),t=o*o,a=`‚àö${t}`;break;case"^":t=rnd(2,9),n=rnd(2,Math.min(4,l+1)),o=t**n,a=`${t}^${n}`}return{q:a,ans:o}}function spawnBomb(){if(d||o.length>=3)return;const e=randomProblem(),t=(a-25)/2e4*m,r=["circle","missile","diamond"];o.push({x:rnd(60,n-60),y:-25,vy:t,r:18,shape:r[rnd(0,r.length-1)],...e})}document.querySelectorAll("#opMenu input[type=checkbox]").forEach(e=>{e.onchange=t=>e.checked?f.add(e.dataset.op):f.delete(e.dataset.op)});const h=document.getElementById("keypad");["1","2","3","4","5","6","7","8","9","0","‚å´","‚èé"].forEach(e=>{const t=document.createElement("button");t.textContent=e,h.appendChild(t)});let v="";function commit(){const e=o.findIndex(e=>e.ans===+v);-1!==e&&(o.splice(e,1),r++,p.cloneNode().play()),v="",updateHUD()}function updateHUD(){$("#hud").textContent=`Aciertos ${r}  Errores ${s}/5`,g.textContent=v}function update(e){o.forEach(t=>t.y+=t.vy*e),o=o.filter(e=>!(e.y-e.r>a)||(s--,u.cloneNode().play(),!1)),s<=0&&(d=!0,o=[]),!d&&performance.now()>c&&(spawnBomb(),c=performance.now()+3500/l)}function draw(){t.clearRect(0,0,n,a),t.fillStyle="#0a0a2a",t.fillRect(0,0,n,a),t.fillStyle="#333";for(let e=0;e<n;e+=50){const n=rnd(20,80);t.fillRect(e,a-n,40,n)}t.strokeStyle=t.fillStyle="white",t.lineWidth=2,o.forEach(e=>{switch(e.shape){case"circle":t.beginPath(),t.arc(e.x,e.y,e.r,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e.x,e.y-e.r),t.lineTo(e.x,e.y-e.r-8),t.stroke();break;case"missile":t.beginPath(),t.rect(e.x-10,e.y-20,20,40),t.stroke(),t.beginPath(),t.moveTo(e.x,e.y-30),t.lineTo(e.x-10,e.y-20),t.lineTo(e.x+10,e.y-20),t.closePath(),t.stroke();break;case"diamond":t.beginPath(),t.moveTo(e.x,e.y-e.r),t.lineTo(e.x+e.r,e.y),t.lineTo(e.x,e.y+e.r),t.lineTo(e.x-e.r,e.y),t.closePath(),t.stroke()}t.font='16px "Share Tech Mono", monospace',t.textAlign="center",t.fillText(e.q,e.x,e.y+5)})}function loop(e){const o=e-i;i=e,d?(t.fillStyle="rgba(0,0,0,.8)",t.fillRect(0,0,n,a),t.fillStyle="#fff",t.font='48px "Share Tech Mono", monospace',t.textAlign="center",t.fillText("GAME OVER",n/2,a/2)):(update(o),draw(),requestAnimationFrame(loop)),updateHUD()}h.addEventListener("click",e=>{const t=e.target.textContent;"‚å´"===t?v=v.slice(0,-1):"‚èé"===t?commit():v+=t,updateHUD()}),document.addEventListener("keydown",e=>{/[0-9]/.test(e.key)?(v+=e.key,updateHUD()):"Backspace"===e.key?(v=v.slice(0,-1),updateHUD()):"Enter"===e.key&&commit()}),$("#restartBtn").addEventListener("click",()=>{o=[],r=0,s=5,v="",d=!1,$("#restartBtn").classList.add("hidden"),spawnBomb(),i=performance.now(),loop(i)}),spawnBomb(),loop(performance.now())}const cForm=document.getElementById("contactForm");if(cForm){const b=document.getElementById("dropZone"),L=document.getElementById("fileInput"),y=document.getElementById("fileBtn"),E=document.getElementById("fileList"),S=document.getElementById("formStatus"),x=[];function updateList(){E.innerHTML="",x.forEach(e=>{const t=document.createElement("li");t.textContent=e.name,E.appendChild(t)})}y.addEventListener("click",()=>L.click()),L.addEventListener("change",e=>{x.push(...e.target.files),updateList()}),b.addEventListener("dragover",e=>{e.preventDefault(),b.classList.add("dragover")}),b.addEventListener("dragleave",()=>b.classList.remove("dragover")),b.addEventListener("drop",e=>{e.preventDefault(),b.classList.remove("dragover"),x.push(...e.dataTransfer.files),updateList()}),cForm.addEventListener("submit",e=>{e.preventDefault(),S.textContent="Enviando...";const t=new FormData(cForm);x.forEach(e=>t.append("archivos[]",e)),fetch("save.php",{method:"POST",body:t}).then(e=>e.json()).then(e=>{S.textContent=e.ok?"Recibido":"Error al enviar",e.ok&&(cForm.reset(),x.length=0,updateList())}).catch(()=>S.textContent="Error al enviar")})}